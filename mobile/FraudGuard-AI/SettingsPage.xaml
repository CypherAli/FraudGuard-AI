<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="FraudGuardAI.SettingsPage"
             Title="Settings"
             Shell.NavBarIsVisible="False">

    <ScrollView>
        <VerticalStackLayout Padding="20,48,20,32" Spacing="20">
            
            <!-- Header -->
            <VerticalStackLayout Spacing="8" Margin="0,0,0,12">
                <Label Text="Settings"
                       FontSize="26"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextPrimary}"/>
                
                <Label Text="Configure server connection"
                       FontSize="14"
                       TextColor="{StaticResource TextSecondary}"/>
            </VerticalStackLayout>

            <!-- Connection Mode Card -->
            <Border Style="{StaticResource CardBorder}">
                <Border.Shadow>
                    <Shadow Brush="#000000"
                           Opacity="0.25"
                           Radius="16"
                           Offset="0,6"/>
                </Border.Shadow>

                <VerticalStackLayout Spacing="16">
                    <!-- USB Mode Toggle -->
                    <HorizontalStackLayout Spacing="12" Padding="0,0,0,8">
                        <Border WidthRequest="40"
                               HeightRequest="40"
                               BackgroundColor="{StaticResource AccentBlue20}"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Label Text="ðŸ”Œ"
                                   FontSize="18"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="StartAndExpand">
                            <Label Text="USB Mode"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}"/>
                            <Label Text="Auto-connect when plugged via USB"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}"/>
                        </VerticalStackLayout>
                        <Switch x:Name="UsbModeSwitch"
                               OnColor="{StaticResource SafeGreen}"
                               ThumbColor="White"
                               VerticalOptions="Center"
                               Toggled="OnUsbModeToggled"/>
                    </HorizontalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1" 
                            BackgroundColor="{StaticResource BorderColor}"
                            Margin="0,4"/>

                    <!-- Section Header -->
                    <HorizontalStackLayout Spacing="12">
                        <Border WidthRequest="40"
                               HeightRequest="40"
                               BackgroundColor="{StaticResource AccentBlue20}"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Label Text="ðŸŒ"
                                   FontSize="18"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Server Address"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}"/>
                            <Label x:Name="ServerModeLabel"
                                   Text="Enter your server IP"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <!-- Hints -->
                    <Border BackgroundColor="{StaticResource InputBackground}"
                           StrokeThickness="1"
                           Stroke="{StaticResource BorderColor}"
                           Padding="14">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        
                        <VerticalStackLayout Spacing="6">
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="â€¢" TextColor="{StaticResource TextSecondary}"/>
                                <Label TextColor="{StaticResource TextSecondary}" FontSize="13">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Ngrok: "/>
                                            <Span Text="https://xxxx.ngrok-free.app" FontAttributes="Bold" TextColor="{StaticResource SafeGreen}"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                            </HorizontalStackLayout>
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="â€¢" TextColor="{StaticResource TextSecondary}"/>
                                <Label TextColor="{StaticResource TextSecondary}" FontSize="13">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="LAN: "/>
                                            <Span Text="http://192.168.1.12:8080" FontAttributes="Bold" TextColor="{StaticResource AccentBlue}"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                            </HorizontalStackLayout>
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="â€¢" TextColor="{StaticResource TextSecondary}"/>
                                <Label TextColor="{StaticResource TextSecondary}" FontSize="13">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Emulator: "/>
                                            <Span Text="http://10.0.2.2:8080" FontAttributes="Bold" TextColor="{StaticResource WarningYellow}"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Border>

                    <!-- URL Input -->
                    <VerticalStackLayout x:Name="IPInputSection" Spacing="8">
                        <Label Text="Server URL"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextSecondary}"/>
                        
                        <Border Style="{StaticResource InputBorder}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            
                            <Entry x:Name="ServerIPEntry"
                                   Placeholder="https://xxxx.ngrok-free.app or http://192.168.1.12:8080"
                                   PlaceholderColor="#5C6B7A"
                                   TextColor="{StaticResource TextPrimary}"
                                   BackgroundColor="Transparent"
                                   FontSize="14"
                                   Keyboard="Url"
                                   Margin="12,8"/>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Current Config -->
                    <Border BackgroundColor="{StaticResource InputBg}"
                           StrokeThickness="1"
                           Stroke="{StaticResource BorderColor}"
                           Padding="14">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Current Configuration"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextSecondary}"/>
                            <Label x:Name="CurrentConfigLabel"
                                   Text="ws://192.168.1.234:8080/ws"
                                   FontSize="12"
                                   TextColor="{StaticResource AccentBlue}"/>
                            <Label x:Name="CurrentAPILabel"
                                   Text="http://192.168.1.234:8080/api"
                                   FontSize="12"
                                   TextColor="{StaticResource AccentBlue}"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Buttons -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <Button x:Name="SaveButton"
                               Grid.Column="0"
                               Text="Save"
                               FontSize="15"
                               FontAttributes="Bold"
                               BackgroundColor="{StaticResource SafeGreen}"
                               TextColor="#0D1B2A"
                               CornerRadius="14"
                               HeightRequest="48"
                               Clicked="OnSaveButtonClicked"/>
                        
                        <Button x:Name="TestButton"
                               Grid.Column="1"
                               Text="Test"
                               FontSize="15"
                               FontAttributes="Bold"
                               BackgroundColor="{StaticResource AccentBlue}"
                               TextColor="White"
                               CornerRadius="14"
                               HeightRequest="48"
                               Clicked="OnTestConnectionClicked"/>
                    </Grid>
                    
                    <!-- Production Server Button -->
                    <Button Text="ðŸŒ Use Production Server (Render)"
                           FontSize="14"
                           FontAttributes="Bold"
                           BackgroundColor="#7C3AED"
                           TextColor="White"
                           CornerRadius="14"
                           HeightRequest="48"
                           Clicked="OnUseProductionClicked"/>
                </VerticalStackLayout>
            </Border>

            <!-- Device ID Card -->
            <Border BackgroundColor="{StaticResource CardBg}"
                   StrokeThickness="0"
                   Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="#000000"
                           Opacity="0.25"
                           Radius="16"
                           Offset="0,6"/>
                </Border.Shadow>

                <VerticalStackLayout Spacing="16">
                    <!-- Section Header -->
                    <HorizontalStackLayout Spacing="12">
                        <Border WidthRequest="40"
                               HeightRequest="40"
                               BackgroundColor="#FBBF2420"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Label Text="ðŸ“±"
                                   FontSize="18"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Device ID"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}"/>
                            <Label Text="Unique device identifier"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <!-- Device ID Input -->
                    <Border BackgroundColor="{StaticResource InputBg}"
                           StrokeThickness="1"
                           Stroke="{StaticResource BorderColor}"
                           Padding="4">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        
                        <Entry x:Name="DeviceIDEntry"
                               Placeholder="my_device"
                               PlaceholderColor="#5C6B7A"
                               TextColor="{StaticResource TextPrimary}"
                               BackgroundColor="Transparent"
                               FontSize="16"
                               MaxLength="50"
                               Margin="12,8"/>
                    </Border>

                    <Button Text="Save Device ID"
                           FontSize="15"
                           FontAttributes="Bold"
                           BackgroundColor="{StaticResource WarningYellow}"
                           TextColor="#0D1B2A"
                           CornerRadius="14"
                           HeightRequest="48"
                           Clicked="OnSaveDeviceIDClicked"/>
                </VerticalStackLayout>
            </Border>

            <!-- Help Card -->
            <Border BackgroundColor="#1B3A4D"
                   StrokeThickness="0"
                   Padding="16">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="10">
                    <Label Text="How to find your LAN IP"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}"/>
                    
                    <VerticalStackLayout Spacing="6">
                        <Label Text="1. Open Command Prompt / Terminal"
                               FontSize="12"
                               TextColor="{StaticResource TextSecondary}"/>
                        <Label FontSize="12" TextColor="{StaticResource TextSecondary}">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="2. Type: "/>
                                    <Span Text="ipconfig" FontAttributes="Bold" TextColor="{StaticResource SafeGreen}"/>
                                    <Span Text=" (Win) or "/>
                                    <Span Text="ifconfig" FontAttributes="Bold" TextColor="{StaticResource SafeGreen}"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                        <Label Text="3. Find IPv4 Address (e.g., 192.168.1.x)"
                               FontSize="12"
                               TextColor="{StaticResource TextSecondary}"/>
                        <Label Text="4. Ensure both devices are on same WiFi"
                               FontSize="12"
                               TextColor="{StaticResource TextSecondary}"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- Account Section -->
            <Border BackgroundColor="{StaticResource CardBg}"
                   StrokeThickness="0"
                   Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="#000000"
                           Opacity="0.25"
                           Radius="16"
                           Offset="0,6"/>
                </Border.Shadow>

                <VerticalStackLayout Spacing="16">
                    <!-- Section Header -->
                    <HorizontalStackLayout Spacing="12">
                        <Border WidthRequest="40"
                               HeightRequest="40"
                               BackgroundColor="#EF444420"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Label Text="ðŸ‘¤"
                                   FontSize="18"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="TÃ i khoáº£n"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}"/>
                            <Label x:Name="UserPhoneLabel"
                                   Text="Äang táº£i..."
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <!-- Logout Button -->
                    <Button x:Name="LogoutButton"
                           Text="ðŸšª ÄÄƒng xuáº¥t"
                           FontSize="15"
                           FontAttributes="Bold"
                           BackgroundColor="#EF4444"
                           TextColor="White"
                           CornerRadius="14"
                           HeightRequest="48"
                           Clicked="OnLogoutClicked"/>
                </VerticalStackLayout>
            </Border>

            <!-- Status Label -->
            <Label x:Name="StatusLabel"
                   Text=""
                   FontSize="14"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{StaticResource SafeGreen}"
                   IsVisible="False"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
